DROP DATABASE IF EXISTS MARS_DB;
CREATE DATABASE MARS_DB;
USE MARS_DB;

DROP TABLE IF EXISTS person;
CREATE TABLE person (
  person_id      BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  full_name      TEXT        NOT NULL,
  email          TEXT        UNIQUE,
  birth_date     DATE,
  phone_number         TEXT        CHECK (gender IN ('male','female','other','unknown')),
  emergency_contact_name TEXT,
    emergency_contact_phone TEXT,
  created_at     TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- Unstructured medical notes (many per person)
DROP TABLE IF EXISTS medical_history;
CREATE TABLE medical_history (
  note_id        BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  person_id      BIGINT NOT NULL REFERENCES person(person_id) ON DELETE CASCADE,
  medical_note      TEXT   NOT NULL,
  created_at     TIMESTAMPTZ NOT NULL DEFAULT now()
);

DROP TABLE IF EXISTS allergies;
CREATE TABLE allergies (
  allergy_id     BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  person_id      BIGINT NOT NULL REFERENCES person(person_id) ON DELETE CASCADE,
  allergen       TEXT   NOT NULL,
  severity       TEXT   CHECK (severity IN ('mild','moderate','severe')),
  reaction       TEXT,
  created_at     TIMESTAMPTZ NOT NULL DEFAULT now()
);